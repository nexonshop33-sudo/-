-- üì¶ Services
local Players = game:GetService("Players")
local VirtualInputManager = game:GetService("VirtualInputManager")
local Workspace = game:GetService("Workspace")

-- üßç Player setup
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")
local cam = Workspace.CurrentCamera

-- üéÉ Path setup
local pumpkinFolder = Workspace:WaitForChild("Interactions")
	:WaitForChild("Nodes")
	:WaitForChild("SmashablePumpkins")
	:WaitForChild("ActiveNodes")

-- ‚öôÔ∏è ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
local isRunning = false
getgenv().PumpkinEnabled = false

-- üìä ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏Ç‡∏≠‡∏á‡∏ü‡∏±‡∏Å‡∏ó‡∏≠‡∏á
local function getHealthRatio(pumpkin)
	local gui = pumpkin:FindFirstChild("InteractGui")
	if not gui then return nil end
	local healthLabel = gui:FindFirstChild("HealthLabel")
	if not healthLabel then return nil end
	local amountLabel = healthLabel:FindFirstChild("AmountLabel")
	if not amountLabel then return nil end

	local text = amountLabel.Text
	if not text or text == "" then
		for _ = 1, 15 do
			task.wait(0.05)
			if amountLabel.Text ~= "" then
				text = amountLabel.Text
				break
			end
		end
	end

	local current, max = string.match(text, "(%d+)%s*/%s*(%d+)")
	if current and max then
		return tonumber(current), tonumber(max)
	end
	return nil
end

-- üñ±Ô∏è ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ã‡πâ‡∏≤‡∏¢
local function simulateClickAtPumpkin(targetPumpkin, count)
	count = count or 10
	for i = 1, count do
		local pos = targetPumpkin:GetPivot().Position
		local screenPos, onScreen = cam:WorldToViewportPoint(pos)
		if onScreen then
			VirtualInputManager:SendMouseButtonEvent(screenPos.X, screenPos.Y, 0, true, game, 0)
			task.wait(0.02)
			VirtualInputManager:SendMouseButtonEvent(screenPos.X, screenPos.Y, 0, false, game, 0)
		end
		task.wait(0.03)
	end
end

-- üí• ‡∏¢‡∏¥‡∏á‡∏£‡∏µ‡πÇ‡∏°‡∏ó DamageRemote ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏ß
local function fireRemoteForPumpkin(targetPumpkin)
	print("üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏¢‡∏¥‡∏á Remote ‡πÉ‡∏™‡πà:", targetPumpkin.Name)
	local lastHP, sameHPCount = nil, 0

	while getgenv().PumpkinEnabled and task.wait(0.05) do
		local current, max = getHealthRatio(targetPumpkin)
		if not current or current <= 0 then
			print("‚úÖ ‡∏ü‡∏±‡∏Å‡∏ó‡∏≠‡∏á", targetPumpkin.Name, "‡∏ñ‡∏π‡∏Å‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß!")
			break
		end

		if lastHP and current == lastHP then
			sameHPCount += 1
			if sameHPCount >= 10 then
				print("‚ö†Ô∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÑ‡∏°‡πà‡∏•‡∏î ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä Remote + ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà")
				simulateClickAtPumpkin(targetPumpkin, 10)
				sameHPCount = 0
			end
		else
			sameHPCount = 0
		end
		lastHP = current

		local remote
		pcall(function()
			local terrain = Workspace:FindFirstChild("Terrain")
			if terrain then
				local meteor = terrain:FindFirstChild("SpawnedMeteor")
				if meteor then
					remote = meteor:FindFirstChild("DamageRemote")
				end
			end
		end)

		if remote then
			pcall(function()
				remote:FireServer()
			end)
		end
	end
end

-- üß≠ ‡∏´‡∏≤‡∏ü‡∏±‡∏Å‡∏ó‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
local function smashNearestPumpkin()
	isRunning = true

	while getgenv().PumpkinEnabled and isRunning do
		local allPumpkins = pumpkinFolder:GetChildren()
		local targetPumpkin, lowestHP = nil, math.huge

		for _, pumpkin in ipairs(allPumpkins) do
			local current, max = getHealthRatio(pumpkin)
			if current and max and current > 0 and current < lowestHP then
				lowestHP = current
				targetPumpkin = pumpkin
			end
		end

		if not targetPumpkin then
			print("üéÉ ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ü‡∏±‡∏Å‡∏ó‡∏≠‡∏á ‚Äî ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏´‡∏¢‡∏∏‡∏î")
			cam.CameraType = Enum.CameraType.Custom
			isRunning = false
			getgenv().PumpkinEnabled = false
			break
		end

		local current, max = getHealthRatio(targetPumpkin)
		print(("üéØ ‡πÄ‡∏à‡∏≠‡∏ü‡∏±‡∏Å‡∏ó‡∏≠‡∏á %s | HP: %d/%d"):format(targetPumpkin.Name, current or 0, max or 0))

		pcall(function()
			hrp.CFrame = targetPumpkin:GetPivot() + Vector3.new(0, 3, 0)
		end)

		simulateClickAtPumpkin(targetPumpkin, 10)
		fireRemoteForPumpkin(targetPumpkin)

		task.wait(0.2)
	end
end

-- üß± GUI SETUP
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "PumpkinAutoFarmGUI"
ScreenGui.Parent = game:GetService("CoreGui")

local Frame = Instance.new("Frame")
Frame.Parent = ScreenGui
Frame.Size = UDim2.new(0, 240, 0, 110)
Frame.Position = UDim2.new(0.05, 0, 0.2, 0)
Frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Draggable = true

local Title = Instance.new("TextLabel")
Title.Parent = Frame
Title.Text = "üéÉ Auto Pumpkin"
Title.Size = UDim2.new(1, 0, 0, 30)
Title.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 16

local ToggleButton = Instance.new("TextButton")
ToggleButton.Parent = Frame
ToggleButton.Size = UDim2.new(0.8, 0, 0, 40)
ToggleButton.Position = UDim2.new(0.1, 0, 0.45, 0)
ToggleButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
ToggleButton.Text = "OFF"
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.Font = Enum.Font.GothamBold
ToggleButton.TextSize = 18
ToggleButton.AutoButtonColor = false
ToggleButton.BorderSizePixel = 0

-- üîò ‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î GUI
local CloseButton = Instance.new("TextButton")
CloseButton.Parent = Frame
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -35, 0, 0)
CloseButton.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextSize = 16
CloseButton.BorderSizePixel = 0

-- ü™Ñ ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå Hover
ToggleButton.MouseEnter:Connect(function()
	ToggleButton.BackgroundColor3 = getgenv().PumpkinEnabled and Color3.fromRGB(70, 255, 100) or Color3.fromRGB(255, 70, 70)
end)
ToggleButton.MouseLeave:Connect(function()
	ToggleButton.BackgroundColor3 = getgenv().PumpkinEnabled and Color3.fromRGB(50, 200, 80) or Color3.fromRGB(200, 50, 50)
end)

-- üéÆ ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î
local function startPumpkin()
	getgenv().PumpkinEnabled = true
	ToggleButton.Text = "ON"
	ToggleButton.BackgroundColor3 = Color3.fromRGB(50, 200, 80)
	print("‚úÖ Auto Smash Pumpkin Enabled")
	task.spawn(smashNearestPumpkin)
end

local function stopPumpkin()
	getgenv().PumpkinEnabled = false
	isRunning = false
	cam.CameraType = Enum.CameraType.Custom
	ToggleButton.Text = "OFF"
	ToggleButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
	print("‚èπÔ∏è Auto Smash Pumpkin Disabled")
end

ToggleButton.MouseButton1Click:Connect(function()
	if getgenv().PumpkinEnabled then
		stopPumpkin()
	else
		startPumpkin()
	end
end)

-- ‚ùå ‡∏õ‡∏¥‡∏î GUI ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
CloseButton.MouseButton1Click:Connect(function()
	stopPumpkin()
	ScreenGui:Destroy()
	print("‚ùå GUI ‡∏ñ‡∏π‡∏Å‡∏õ‡∏¥‡∏î‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å CoreGui ‡πÅ‡∏•‡πâ‡∏ß")
end)

print("üéÉ Auto Smash Pumpkin GUI Loaded ‚úÖ")
